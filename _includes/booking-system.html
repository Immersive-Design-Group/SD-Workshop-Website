<!-- Booking System HTML Template - Matching Your Design -->
<link rel="stylesheet" href="{{ '/assets/css/booking-system.css' | relative_url }}">

<!-- Main Booking Container -->
<div class="reservation-container">
  
  <!-- Title Section -->
  <div class="reservation-title-section">
    <h1 class="reservation-main-title">Our<br>Reservation</h1>
  </div>
  
  <!-- Rules Section (Your Chinese/English rules) -->
  <div class="rules-section">
    <h3>预约规则</h3>
    <div class="rules-content">
      <ul class="rules-list-chinese">
        <li>请在下方选择日期中选择空闲时段预约，最长不可超过5小时（工作坊开放时间：周一至周五09:00-22:00）</li>
        <li>超22点后工坊将关闭，如需时间接触设备，可在22点前开始打印第二天早上来取</li>
        <li>首次使用相关设备安全培训，使用设备前，请仔细阅读设备作说明书</li>
        <li>有假日使用请明请群主工坊管理员 (designworkshop@sustech.edu.cn) 咨询许可</li>
      </ul>
      
      <ul class="rules-list-english">
        <li>Please select a free slot below for booking, with a maximum duration of 5 hours. (workshop opening hours: Monday to Friday 09:00-22:00).</li>
        <li>Workshop closes after 22:00, but machines run on. You may start printing before 22:00 and pick up next morning.</li>
        <li>Safety training must be completed before first use, please read the operation manual carefully before using the equipment.</li>
        <li>For use on holidays, please email the workshop administrator at designworkshop@sustech.edu.cn (example email provided).</li>
      </ul>
    </div>
  </div>

  <!-- Date Selection -->
  <div class="date-selection">
    <div class="date-button active" id="selected-date-display">7月12日</div>
    <input type="date" id="date-picker" style="display: none;">
  </div>

  <!-- Booking Grid -->
  <div class="booking-grid-container">
    <!-- Time Header -->
    <div class="time-header">
      <div class="equipment-column-header"></div>
      <div class="time-slots-header" id="time-slots-header">
        <!-- Time slots will be generated by JavaScript -->
      </div>
    </div>

    <!-- Equipment Rows -->
    <div class="equipment-grid" id="equipment-grid">
      <!-- Equipment rows will be generated by JavaScript -->
    </div>

    <!-- Current Time Indicator -->
    <div class="current-time-indicator" id="current-time-indicator"></div>
  </div>
</div>

<!-- Booking Modal -->
<div class="modal-overlay" id="booking-modal">
  <div class="modal-content booking-modal">
    <div class="modal-header">
      <h2 id="modal-equipment-title">3D Printer 1<br><span class="equipment-model">X1E</span></h2>
      <button class="close-btn" onclick="closeBookingModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <label for="user-name">Name *</label>
        <input type="text" id="user-name" required>
      </div>
      
      <div class="form-row">
        <label for="user-phone">Phone *</label>
        <input type="tel" id="user-phone" required>
      </div>
      
      <div class="form-row">
        <label for="user-email">Email *</label>
        <input type="email" id="user-email" required>
      </div>
      
      <div class="form-row">
        <label for="booking-purpose">Purpose</label>
        <textarea id="booking-purpose" rows="3"></textarea>
      </div>
      
      <div class="time-display">
        <label>Time *</label>
        <div class="time-selection">
          <span class="date-display" id="booking-date-display">0712</span>
          <span class="time-range">
            <span id="start-time-display">10:00</span>
            <span class="arrow">→</span>
            <span id="end-time-display">11:00</span>
          </span>
        </div>
      </div>
      
      <div class="checkbox-container">
        <label class="checkbox-label">
          <input type="checkbox" id="training-accepted" required>
          <span class="checkmark">✓</span>
          I have accepted the training instructions.
        </label>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="submit-btn" onclick="submitBooking()">SUBMIT</button>
    </div>
  </div>
</div>

<!-- Deletion Confirmation Modal -->
<div class="modal-overlay" id="deletion-modal">
  <div class="modal-content deletion-modal">
    <div class="modal-body">
      <h3>Confirm deletion of this reservation?</h3>
      <div class="deletion-info">
        <div class="equipment-info" id="deletion-equipment-info">
          3D Printer 1 X1E<br>
          7.12 10:00-11:00
        </div>
      </div>
      
      <div class="deletion-buttons">
        <button class="cancel-btn" onclick="closeDeletionModal()">CANCEL</button>
        <button class="delete-btn" onclick="confirmDeletion()">DELETE</button>
      </div>
    </div>
  </div>
</div>

<!-- OTP Verification Modal -->
<div class="modal-overlay" id="otp-modal">
  <div class="modal-content otp-modal">
    <div class="modal-body">
      <h3>Enter Verification Code</h3>
      <p>Please enter the OTP sent to your email:</p>
      
      <div class="form-row">
        <input type="text" id="otp-input" maxlength="6" placeholder="Enter 6-digit code">
      </div>
      
      <div class="otp-buttons">
        <button class="cancel-btn" onclick="closeOTPModal()">CANCEL</button>
        <button class="verify-btn" onclick="verifyOTP()">VERIFY</button>
      </div>
    </div>
  </div>
</div>

<!-- Loading Spinner -->
<div class="loading-overlay" id="loading-overlay">
  <div class="loading-spinner"></div>
</div>

<!-- Include JavaScript -->
<script src="{{ '/assets/js/supabase-client.js' | relative_url }}"></script>
<script src="{{ '/assets/js/booking-system.js' | relative_url }}"></script>

<script>
// Initialize booking system with Jekyll data
window.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing booking system...');
  
  // Pass Jekyll data to JavaScript
  const equipmentData = {
    {% for category in site.data.equipment %}
      "{{ category[0] }}": {{ category[1] | jsonify }},
    {% endfor %}
  };
  
  const bookingRules = {{ site.data.booking_rules | jsonify }};
  
  console.log('Jekyll equipment data:', equipmentData);
  console.log('Jekyll booking rules:', bookingRules);
  
  // Check if the main function exists
  if (typeof initializeBookingSystem === 'function') {
    // Initialize the booking system
    initializeBookingSystem(equipmentData, bookingRules);
  } else {
    console.error('initializeBookingSystem function not found. Check if booking-system.js is loaded properly.');
    
    // Show an error message in the grid
    const grid = document.getElementById('equipment-grid');
    if (grid) {
      grid.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">Loading booking system... Please check your JavaScript files.</div>';
    }
  }
});
</script>